il.ScreenshotsInputGUI=function(a){this.post_var=a,this.screenshots=[],this.init()},il.ScreenshotsInputGUI.INSTANCES=[],il.ScreenshotsInputGUI.PAGE_SCREENSHOT_NAME="",il.ScreenshotsInputGUI.SCREENSHOT_TEMPLATE="",il.ScreenshotsInputGUI.lastInstance=function(){return this.INSTANCES[this.INSTANCES.length-1]},il.ScreenshotsInputGUI.newInstance=function(a){this.INSTANCES.push(new this(a))},il.ScreenshotsInputGUI.removeInstance=function(a){a.removePreviewURLCache();var b=this.INSTANCES.indexOf(a);this.INSTANCES.splice(b,1)},il.ScreenshotsInputGUI.prototype={constructor:il.ScreenshotsInputGUI,$add_page_screenshot:null,$add_screenshot:null,$screenshot_file_input:null,$screenshots:null,element:null,modal:null,post_var:"",previewURLCache:[],screenshots:[],addPageScreenshot:function(){this.hideModal(),html2canvas($("html")[0]).then(this.addPageScreenshot2.bind(this)).catch(this.addPageScreenshot4.bind(this))},addPageScreenshot2:function(a){this.restoreModal(),a.toBlob(this.addPageScreenshot3.bind(this),"image/png")},addPageScreenshot3:function(a){var b;try{b=new File([a],this.constructor.PAGE_SCREENSHOT_NAME+".png",{type:a.type})}catch(c){b=a}this.screenshots.push(b),this.updateScreenshots()},addPageScreenshot4:function(a){this.restoreModal(),alert(a)},addScreenshot:function(){this.$screenshot_file_input.click()},addScreenshotOnChange:function(){var a=$(".screenshot_file_input",this.element)[0];""!==a.value&&(Array.prototype.forEach.call(a.files,function(a){this.screenshots.push(a)},this),a.value="",this.updateScreenshots())},addScreenshotsToUpload:function(a){this.screenshots.forEach(function(b){a.append(this.post_var+"[]",b)},this),this.removePreviewURLCache()},hideModal:function(){null!==this.modal&&(this.modal.css("visibility","hidden"),$(".modal-backdrop").css("visibility","hidden"),$("body").css("overflow","visible"))},init:function(){this.element=$("input[type=\"file\"][name=\""+this.post_var+"\"]").parent(),this.$add_screenshot=$(".add_screenshot",this.element),this.$add_page_screenshot=$(".add_page_screenshot",this.element),this.$screenshot_file_input=$(".screenshot_file_input",this.element),this.$screenshots=$(".screenshots",this.element),this.$add_screenshot.click(this.addScreenshot.bind(this)),this.$add_page_screenshot.click(this.addPageScreenshot.bind(this)),this.$screenshot_file_input.change(this.addScreenshotOnChange.bind(this))},removePreviewURLCache:function(){this.previewURLCache.forEach(function(a){URL.revokeObjectURL(a)}),this.previewURLCache=[]},removeScreenshot:function(a){var b=this.screenshots.indexOf(a);this.screenshots.splice(b,1),this.updateScreenshots()},restoreModal:function(){null!==this.modal&&(this.modal.css("visibility",""),$(".modal-backdrop").css("visibility",""),$("body").css("overflow",""))},updateScreenshots:function(){this.$screenshots.empty(),this.removePreviewURLCache(),this.screenshots.forEach(this.updateScreenshot,this)},updateScreenshot:function(a){var b=$(this.constructor.SCREENSHOT_TEMPLATE),c=$(".screenshot_name",b),d=$(".screenshot_remove",b),e=$(".screenshot_preview_link",b),f=$(".screenshot_preview",b),g=URL.createObjectURL(a);c.text(a.name),d.click(this.removeScreenshot.bind(this,a)),e.prop("href",g),f.prop("src",g),f.prop("alt",a.name),this.$screenshots.append(b),this.previewURLCache.push(g)}};
